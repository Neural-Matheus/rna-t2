ADR-005 — Gestão da Janela de Contexto

Contexto

Modelos de linguagem têm limite de contexto e custo proporcional ao número de tokens enviados. Incluir muitos trechos recuperados pode diluir o foco, aumentar custo, gerar respostas mais vagas e, em alguns casos, até introduzir ruído. É necessário um equilíbrio entre qualidade do contexto e tamanho da entrada.

Decisão

Usar apenas os top-3 documentos após o reranking como contexto final do RAG.

Razões

Evita excesso de contexto, reduzindo ruído e dispersão na resposta.

Mantém o foco nos trechos realmente relevantes.

Reduz o custo de tokens enviados ao modelo.

Os top-3 são suficientes para a maioria das consultas sobre regulamentos, que são altamente estruturados e repetitivos.

Configuração

Retrieval inicial: 20 candidatos (bi-encoder).

Contexto final: top-3 após reranking (cross-encoder).

Alternativas Rejeitadas

Enviar todos os 20 trechos: contexto grande demais e respostas menos precisas.

Enviar apenas 1: maior risco de perda de informação e queda de recall.

Consequências

Respostas mais objetivas e consistentes.

Menor custo e latência no pipeline RAG.